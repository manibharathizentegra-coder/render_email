<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Email Inbox</title>

    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: #f4f6f9;
        }
        .email-item:hover {
            background: #eef5ff;
            cursor: pointer;
        }
        .email-item {
            border-bottom: 1px solid #e6e6e6;
            padding: 15px;
        }
        .subject {
            font-size: 1rem;
            font-weight: 600;
        }
        .from {
            font-size: 0.9rem;
            color: #555;
        }
        .date {
            font-size: 0.8rem;
            color: #888;
        }
        .active-email {
            background: #dce9ff !important;
        }
        .mail-full-view{
            background-color: white;
            height: 80vh;
            align-content: center;
        }
    </style>
</head>
<body>

<div class="container-fluid my-4">
    <h2 class="mb-4">üì¨ My Inbox</h2>

    <div class="row">
        <!-- LEFT: Email List -->
        <div class="col-md-4">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    Emails
                </div>
                
                <div id="email-list" class="card-body" style="height: 75vh; overflow-y: auto; scrollbar-width: thin;">
                    <p>Loading emails...</p>
                </div>

                <div class="card-footer text-center">
                    <button class="btn btn-secondary btn-sm me-2" id="prev-btn">Prev</button>
                    <button class="btn btn-primary btn-sm" id="next-btn">Next</button>
                </div>
            </div>
        </div>

        <!-- RIGHT: Email Details -->
        <div class="col-md-8">
            <div class="card shadow-sm" id="email-details" style="display: none;">
                <div class="card-header bg-white">
                    <button class="btn btn-outline-primary btn-sm" id="back-btn">‚Üê Back</button>
                </div>

                <div class="card-body">
                    <h4 id="detail-subject"></h4>
                    <p><strong>From:</strong> <span id="detail-from"></span></p>
                    <p><strong>Date:</strong> <span id="detail-date"></span></p>
                    <hr>
                    <p id="detail-body" class="mt-3"></p>
                </div>
            </div>

            <!-- Placeholder when no email selected -->
            <div id="placeholder-box" class="text-center text-muted mt- mail-full-view rounded-3">
                
                <h3 class="pt-5">Zoho Mail</h3>
                <img src="https://cdn-icons-png.flaticon.com/128/407/407846.png" alt="" style="opacity: 0.8;">
                <p class="pt-5">Select an email to view its content.</p>
            </div>
        </div>
    </div>
</div>


<!-- JS Section -->
<script>
let page = 1;

function loadEmails(page) {
    fetch(`https://render-email.onrender.com/emails/?page=${page}`)
        .then(res => res.json())
        .then(data => {
            const list = document.getElementById("email-list");
            list.innerHTML = "";

            if (data.length === 0) {
                list.innerHTML = "<p class='text-muted'>No more emails.</p>";
                return;
            }

            data.forEach(email => {
                const div = document.createElement("div");
                div.className = "email-item";
                div.innerHTML = `
                    <div class="subject">${email.subject}</div>
                    <div class="from">${email.from}</div>
                    <div class="date">${email.date}</div>
                `;
                div.onclick = () => showDetails(email, div);
                list.appendChild(div);
            });
        });
}

loadEmails(page);

function showDetails(email, divElem) {
    document.getElementById("email-details").style.display = "block";
    document.getElementById("placeholder-box").style.display = "none";

    document.querySelectorAll(".email-item").forEach(i => i.classList.remove("active-email"));
    divElem.classList.add("active-email");

    document.getElementById("detail-subject").innerText = email.subject;
    document.getElementById("detail-from").innerText = email.from;
    document.getElementById("detail-date").innerText = email.date;
    document.getElementById("detail-body").innerText = email.text || "(No text body)";
}

document.getElementById("back-btn").onclick = () => {
    document.getElementById("email-details").style.display = "none";
    document.getElementById("placeholder-box").style.display = "block";
};

document.getElementById("next-btn").onclick = () => {
    page++;
    document.getElementById("email-list").innerHTML = `<p>Loading emails...</p>`
    loadEmails(page);
};

document.getElementById("prev-btn").onclick = () => {
    if (page > 1) {
        page--;
        document.getElementById("email-list").innerHTML = `<p>Loading emails...</p>`
        loadEmails(page);
    }
};
</script>

</body>
</html>
